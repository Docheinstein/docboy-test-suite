DEF LcdPosition = $c000 ; WRAM1

; Args:
; de: position (as VRAM tile)
MACRO WriteLcdPosition
    push hl
    ld hl, LcdPosition
    ld [hl], d
    inc hl
    ld [hl], e
    pop hl
ENDM

; Output:
; de: position (as VRAM tile)
MACRO ReadLcdPosition
    push hl
    ld hl, LcdPosition
    ld d, [hl]
    inc hl
    ld e, [hl]
    pop hl
ENDM


; Initialize ASCII tilemap and reset LCD position.
MACRO InitPrint
    ; Copy ASCII tilemap to VRAM $9000 area.
    Memcpy $9200, AsciiTilemap, AsciiTilemapEnd - AsciiTilemap

    ; Reset print coordinate to (0,0) = $9800.
    ld de, $9800
    WriteLcdPosition
ENDM

; Args:
; a: number
; Output:
; a = ascii(uint4_t a)
MACRO HexDigit
    cp a, $0a
    jp c, .number\@
    add a, $27 ; 'a' - ('0' + $a)
.number\@
    add a, $30 ; '0'
ENDM

MACRO NewLine
    ReadLcdPosition
    push hl

    ld a, e
    and a, $e0

    ld h, d
    ld l, a
    ld de, $0020
    add hl, de
    ld d, h
    ld e, l

    pop hl
    WriteLcdPosition
ENDM

; Args
; a: ascii character
MACRO PutChar
    ReadLcdPosition
    ld [de], a
    inc de
    WriteLcdPosition
ENDM

; Args
; a: number
MACRO PutHex4
    and a, $0f
    HexDigit
    PutChar
ENDM

; Args
; a: number
MACRO PutHex8
    ; First nibble
    ld b, a
    swap a
    PutHex4

    ; Second nibble
    ld a, b
    PutHex4
ENDM

; Args
; bc: number
MACRO PutHex16
    ; First byte
    ld a, b
    PutHex8

    ; Second byte
    ld a, c
    PutHex8
ENDM


; Args
; \1: string address (00 terminated)
MACRO PutString
    ld hl, \1 ; string address

.loop\@
    ld a, [hli]

    cp a, $00
    jp z, .end\@

    ; TODO: newline

    PutChar
    jp .loop\@
.end\@
ENDM

; Args
; \1 string
MACRO PrintString
    jp .DoPrint\@
.String\@
    db \1, $00
.DoPrint\@
    PutString .String\@
ENDM


AsciiTilemap:
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00,
db $18, $18, $18, $18, $18, $18, $18, $18, $18, $18, $00, $00, $18, $18, $00, $00,
db $6c, $6c, $6c, $6c, $6c, $6c, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00,
db $6c, $6c, $fe, $fe, $6c, $6c, $6c, $6c, $fe, $fe, $6c, $6c, $00, $00, $00, $00,
db $18, $18, $3e, $3e, $60, $60, $3c, $3c, $06, $06, $7c, $7c, $18, $18, $00, $00,
db $66, $66, $6c, $6c, $18, $18, $30, $30, $60, $60, $c6, $c6, $86, $86, $00, $00,
db $1c, $1c, $36, $36, $1c, $1c, $38, $38, $6f, $6f, $66, $66, $3b, $3b, $00, $00,
db $0c, $0c, $0c, $0c, $0c, $0c, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00,
db $0e, $0e, $1c, $1c, $18, $18, $18, $18, $18, $18, $1c, $1c, $0e, $0e, $00, $00,
db $70, $70, $38, $38, $18, $18, $18, $18, $18, $18, $38, $38, $70, $70, $00, $00,
db $00, $00, $66, $66, $3c, $3c, $ff, $ff, $3c, $3c, $66, $66, $00, $00, $00, $00,
db $00, $00, $18, $18, $18, $18, $7e, $7e, $18, $18, $18, $18, $00, $00, $00, $00,
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $30, $30, $30, $30, $60, $60,
db $00, $00, $00, $00, $00, $00, $7e, $7e, $00, $00, $00, $00, $00, $00, $00, $00,
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $60, $60, $60, $60, $00, $00,
db $02, $02, $06, $06, $0c, $0c, $18, $18, $30, $30, $60, $60, $40, $40, $00, $00,
db $3c, $3c, $66, $66, $6e, $6e, $76, $76, $66, $66, $66, $66, $3c, $3c, $00, $00,
db $18, $18, $38, $38, $18, $18, $18, $18, $18, $18, $18, $18, $7e, $7e, $00, $00,
db $3c, $3c, $66, $66, $06, $06, $0c, $0c, $18, $18, $30, $30, $7e, $7e, $00, $00,
db $7e, $7e, $0c, $0c, $18, $18, $0c, $0c, $06, $06, $66, $66, $3c, $3c, $00, $00,
db $0c, $0c, $1c, $1c, $3c, $3c, $6c, $6c, $7e, $7e, $0c, $0c, $0c, $0c, $00, $00,
db $7e, $7e, $60, $60, $7c, $7c, $06, $06, $06, $06, $66, $66, $3c, $3c, $00, $00,
db $3c, $3c, $60, $60, $60, $60, $7c, $7c, $66, $66, $66, $66, $3c, $3c, $00, $00,
db $7e, $7e, $06, $06, $0c, $0c, $18, $18, $30, $30, $30, $30, $30, $30, $00, $00,
db $3c, $3c, $66, $66, $66, $66, $3c, $3c, $66, $66, $66, $66, $3c, $3c, $00, $00,
db $3c, $3c, $66, $66, $66, $66, $3e, $3e, $06, $06, $0c, $0c, $38, $38, $00, $00,
db $00, $00, $18, $18, $18, $18, $00, $00, $18, $18, $18, $18, $00, $00, $00, $00,
db $00, $00, $18, $18, $18, $18, $00, $00, $18, $18, $18, $18, $30, $30, $00, $00,
db $0c, $0c, $18, $18, $30, $30, $60, $60, $30, $30, $18, $18, $0c, $0c, $00, $00,
db $00, $00, $00, $00, $7e, $7e, $00, $00, $00, $00, $7e, $7e, $00, $00, $00, $00,
db $30, $30, $18, $18, $0c, $0c, $06, $06, $0c, $0c, $18, $18, $30, $30, $00, $00,
db $3c, $3c, $66, $66, $06, $06, $0c, $0c, $18, $18, $00, $00, $18, $18, $00, $00,
db $3c, $3c, $66, $66, $6e, $6e, $6a, $6a, $6e, $6e, $60, $60, $3e, $3e, $00, $00,
db $18, $18, $3c, $3c, $66, $66, $66, $66, $7e, $7e, $66, $66, $66, $66, $00, $00,
db $7c, $7c, $66, $66, $66, $66, $7c, $7c, $66, $66, $66, $66, $7c, $7c, $00, $00,
db $3c, $3c, $66, $66, $60, $60, $60, $60, $60, $60, $66, $66, $3c, $3c, $00, $00,
db $78, $78, $6c, $6c, $66, $66, $66, $66, $66, $66, $6c, $6c, $78, $78, $00, $00,
db $7e, $7e, $60, $60, $60, $60, $7c, $7c, $60, $60, $60, $60, $7e, $7e, $00, $00,
db $7e, $7e, $60, $60, $60, $60, $7c, $7c, $60, $60, $60, $60, $60, $60, $00, $00,
db $3e, $3e, $60, $60, $60, $60, $6e, $6e, $66, $66, $66, $66, $3e, $3e, $00, $00,
db $66, $66, $66, $66, $66, $66, $7e, $7e, $66, $66, $66, $66, $66, $66, $00, $00,
db $3c, $3c, $18, $18, $18, $18, $18, $18, $18, $18, $18, $18, $3c, $3c, $00, $00,
db $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $66, $66, $3c, $3c, $00, $00,
db $66, $66, $6c, $6c, $78, $78, $70, $70, $78, $78, $6c, $6c, $66, $66, $00, $00,
db $60, $60, $60, $60, $60, $60, $60, $60, $60, $60, $60, $60, $7e, $7e, $00, $00,
db $c6, $c6, $ee, $ee, $fe, $fe, $d6, $d6, $c6, $c6, $c6, $c6, $c6, $c6, $00, $00,
db $66, $66, $76, $76, $7e, $7e, $7e, $7e, $6e, $6e, $66, $66, $66, $66, $00, $00,
db $3c, $3c, $66, $66, $66, $66, $66, $66, $66, $66, $66, $66, $3c, $3c, $00, $00,
db $7c, $7c, $66, $66, $66, $66, $7c, $7c, $60, $60, $60, $60, $60, $60, $00, $00,
db $3c, $3c, $66, $66, $66, $66, $66, $66, $76, $76, $6c, $6c, $36, $36, $00, $00,
db $7c, $7c, $66, $66, $66, $66, $7c, $7c, $6c, $6c, $66, $66, $66, $66, $00, $00,
db $3c, $3c, $66, $66, $60, $60, $3c, $3c, $06, $06, $66, $66, $3c, $3c, $00, $00,
db $7e, $7e, $18, $18, $18, $18, $18, $18, $18, $18, $18, $18, $18, $18, $00, $00,
db $66, $66, $66, $66, $66, $66, $66, $66, $66, $66, $66, $66, $3e, $3e, $00, $00,
db $66, $66, $66, $66, $66, $66, $66, $66, $3c, $3c, $3c, $3c, $18, $18, $00, $00,
db $c6, $c6, $c6, $c6, $c6, $c6, $d6, $d6, $fe, $fe, $ee, $ee, $c6, $c6, $00, $00,
db $66, $66, $66, $66, $3c, $3c, $18, $18, $3c, $3c, $66, $66, $66, $66, $00, $00,
db $66, $66, $66, $66, $66, $66, $3c, $3c, $18, $18, $18, $18, $18, $18, $00, $00,
db $7e, $7e, $06, $06, $0c, $0c, $18, $18, $30, $30, $60, $60, $7e, $7e, $00, $00,
db $1e, $1e, $18, $18, $18, $18, $18, $18, $18, $18, $18, $18, $1e, $1e, $00, $00,
db $40, $40, $60, $60, $30, $30, $18, $18, $0c, $0c, $06, $06, $02, $02, $00, $00,
db $78, $78, $18, $18, $18, $18, $18, $18, $18, $18, $18, $18, $78, $78, $00, $00,
db $10, $10, $38, $38, $6c, $6c, $c6, $c6, $00, $00, $00, $00, $00, $00, $00, $00,
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $fe, $fe,
db $c0, $c0, $60, $60, $30, $30, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00,
db $00, $00, $00, $00, $3c, $3c, $06, $06, $3e, $3e, $66, $66, $3e, $3e, $00, $00,
db $60, $60, $60, $60, $7c, $7c, $66, $66, $66, $66, $66, $66, $7c, $7c, $00, $00,
db $00, $00, $00, $00, $3c, $3c, $60, $60, $60, $60, $60, $60, $3c, $3c, $00, $00,
db $06, $06, $06, $06, $3e, $3e, $66, $66, $66, $66, $66, $66, $3e, $3e, $00, $00,
db $00, $00, $00, $00, $3c, $3c, $66, $66, $7e, $7e, $60, $60, $3c, $3c, $00, $00,
db $1c, $1c, $30, $30, $7c, $7c, $30, $30, $30, $30, $30, $30, $30, $30, $00, $00,
db $00, $00, $00, $00, $3e, $3e, $66, $66, $66, $66, $3e, $3e, $06, $06, $7c, $7c,
db $60, $60, $60, $60, $7c, $7c, $66, $66, $66, $66, $66, $66, $66, $66, $00, $00,
db $18, $18, $00, $00, $38, $38, $18, $18, $18, $18, $18, $18, $3c, $3c, $00, $00,
db $18, $18, $00, $00, $18, $18, $18, $18, $18, $18, $18, $18, $18, $18, $70, $70,
db $60, $60, $60, $60, $66, $66, $6c, $6c, $78, $78, $6c, $6c, $66, $66, $00, $00,
db $38, $38, $18, $18, $18, $18, $18, $18, $18, $18, $18, $18, $3c, $3c, $00, $00,
db $00, $00, $00, $00, $ec, $ec, $fe, $fe, $d6, $d6, $c6, $c6, $c6, $c6, $00, $00,
db $00, $00, $00, $00, $7c, $7c, $66, $66, $66, $66, $66, $66, $66, $66, $00, $00,
db $00, $00, $00, $00, $3c, $3c, $66, $66, $66, $66, $66, $66, $3c, $3c, $00, $00,
db $00, $00, $00, $00, $7c, $7c, $66, $66, $66, $66, $66, $66, $7c, $7c, $60, $60,
db $00, $00, $00, $00, $3e, $3e, $66, $66, $66, $66, $66, $66, $3e, $3e, $06, $06,
db $00, $00, $00, $00, $7c, $7c, $66, $66, $60, $60, $60, $60, $60, $60, $00, $00,
db $00, $00, $00, $00, $3e, $3e, $60, $60, $3c, $3c, $06, $06, $7c, $7c, $00, $00,
db $00, $00, $18, $18, $7e, $7e, $18, $18, $18, $18, $18, $18, $0e, $0e, $00, $00,
db $00, $00, $00, $00, $66, $66, $66, $66, $66, $66, $66, $66, $3e, $3e, $00, $00,
db $00, $00, $00, $00, $66, $66, $66, $66, $66, $66, $3c, $3c, $18, $18, $00, $00,
db $00, $00, $00, $00, $c6, $c6, $c6, $c6, $d6, $d6, $7c, $7c, $6c, $6c, $00, $00,
db $00, $00, $00, $00, $66, $66, $3c, $3c, $18, $18, $3c, $3c, $66, $66, $00, $00,
db $00, $00, $00, $00, $66, $66, $66, $66, $66, $66, $3e, $3e, $06, $06, $7c, $7c,
db $00, $00, $00, $00, $7e, $7e, $0c, $0c, $18, $18, $30, $30, $7e, $7e, $00, $00,
db $0e, $0e, $18, $18, $18, $18, $30, $30, $18, $18, $18, $18, $0e, $0e, $00, $00,
db $18, $18, $18, $18, $18, $18, $18, $18, $18, $18, $18, $18, $18, $18, $00, $00,
db $70, $70, $18, $18, $18, $18, $0c, $0c, $18, $18, $18, $18, $70, $70, $00, $00,
db $00, $00, $00, $00, $60, $60, $f2, $f2, $9e, $9e, $0c, $0c, $00, $00, $00, $00,
db $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00,
AsciiTilemapEnd: